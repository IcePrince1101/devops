
# CI/CD

## Part 1 Установка Girlab-Runner
- Целью задания было установить утилиту gitlab-runner на виртуальную машину ubuntu server 22.04 LTS.
    - Для начала установим все необходимые библиотеки для дальнейшей работы

    ![img/1.1.jpg](img/1.1.jpg)    

    - Устанавливаем gitlab-runner на виртуальной машине при помоще следующих команд:

    ![img/1.2.jpg](img/1.2.jpg)

    - Затем прописываем `sudo apt install gitlab-runner`

    - Запускаем `sudo gitlab-runner register`
    ![img/1.3.jpg](img/1.3.jpg)

    Важно указать верный тэг для дальнейшей работы ы gitlab-runner, иначе цели не будут выполнены  утилита будет выдавать ошибку.
    
    - Запускаем `sudo gitlab-runner run`

    ![img/1.4.jpg](img/1.4.jpg)

## Part 2 Сборка
- Целью задания было написать этап для CI по сборке приложений из проекта C2_SimpleBashUtils:
    - В файле gitlab-ci.yml добавить этап запуска сборки через makefile из проекта C2. Файлы, полученные после сборки (артефакты), сохранять в произвольную директорию со сроком хранения 30 дней.
    
    ![img/2.1.jpg](img/2.1.jpg) 

    Tag `simple_bash` был прописан мной при регистрации gitlab-runner
    
    ![img/2.2.jpg](img/2.2.jpg)
    *вывод результатов сборки*  

## Part 3 Тест кодстайла
- Целью задания было написать этап для **CI**, который запускает скрипт кодстайла (*clang-format*):
    - следующие изменения были внесены в .gitlab-ci.yml файл:
    
    ![img/3.1.jpg](img/3.1.jpg)
    
    - Скрин с 2 пайплайнами
    
    ![img/3.2.jpg](img/3.2.jpg)
    
    - вывод утилиты *clang-format* при зафейленном пайплайне:
    
    ![img/3.3.jpg](img/3.3.jpg)
    
    - вывод утилиты *clang-format* при успешном пайплане:
    
    ![img/3.4.jpg](img/3.4.jpg)

## Part 4. Интеграционные тесты
- Целью задания было написать этап для **CI**, который запускает интеграционные тесты из того же проекта:
    - следующие изменения были внесены в .gitlab-ci.yml файл:
    
    ![img/4.1.jpg](img/4.1.jpg)
    
    - Скрин с 2 пайплайнами
    
    ![img/4.2.jpg](img/4.2.jpg)
    
    - вывод интеграционных тестов при зафейленном пайплайне:
    
    ![img/4.3.jpg](img/4.3.jpg)
    
    - вывод интеграционных тестов при успешном пайплане:
    
    ![img/4.4.jpg](img/4.4.jpg)



### Part 5. Этап деплоя
- Целью задания было написать этап для **CI**, который запускает деплой приложений из проекта C2_SimpleBashUtils:
    - следующие изменения были внесены в .gitlab-ci.yml файл:
    
    ![img/5.1.jpg](img/5.1.jpg)
    
    - создаем вторую виртуальную машину, настраиваем параметры сети

    ![img/5.2.jpg](img/5.2.jpg)

    - проверяем, пингуются ли машины

    ![img/5.3.jpg](img/5.3.jpg)

    - создаем ssh ключ для второго пользователя в gitlab-runner на виртуальной машине S21_CI/CD и настроим доступ по ssh.
    ```
    sudo su gitlab-runner
    ssh-keygen -t rsa -b 2048
    ssh-copy-id camillec@192.168.100.11
    ssh  camillec@192.168.100.11
    ```
    - На виртуальной машине S21_DEPLOY так же создадим ключ и настроим доступ.
    ```
    ssh-keygen -t rsa -b 2048
    ssh-copy-id  camillec@192.168.100.10
    sudo chown -R $(whoami) /usr/local/bin
    ```
    - создаем bash скрипт deploy_script.sh:
    
    ![img/5.4.jpg](img/5.4.jpg)

    - пушим наш код с дополнением в виде deply_script.sh

    ![img/5.5.jpg](img/5.5.jpg)

### BONUS PART
- Целью задания было настроить уведомления об успешном/неуспешном выполнении пайплайна через бота с именем «[твой nickname] DO6 CI/CD» в *Telegram*.
    - зарегистрируем бота в телеграм 
    
    ![img/6.1.jpg](img/6.1.jpg)

    - напишем скрипт для нашего телеграм бота

    ![img/6.2.jpg](img/6.2.jpg)

    - добавим изменения на стадии deploy в .gitlab-ci.yml файл

    ![img/6.3.jpg](img/6.3.jpg)

    - пользуемся

    ![img/6.4.jpg](img/6.4.jpg)



